<Window x:Class="IcdControl.Client.IcdEditorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="ICD Editor" Height="700" Width="1000"
        WindowStartupLocation="CenterScreen" Background="{StaticResource BackgroundColor}"
        KeyDown="Window_KeyDown">

    <Window.Resources>
        <ContextMenu x:Key="ItemContextMenu">
            <MenuItem Header="Add Field" Click="Ctx_AddField_Click"/>
            <MenuItem Header="Add Nested Struct" Click="Ctx_AddStruct_Click"/>
            <Separator/>
            <MenuItem Header="Delete" Click="Ctx_Delete_Click" Foreground="Red"/>
        </ContextMenu>

        <ContextMenu x:Key="RootContextMenu">
            <MenuItem Header="Add New Item" Click="Ctx_AddNewItem_Click" FontWeight="Bold"/>
        </ContextMenu>
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <Border Background="White" BorderBrush="{StaticResource BorderColor}" BorderThickness="0,0,0,1" Padding="20,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="ICD Name:" VerticalAlignment="Center" Foreground="{StaticResource TextSecondaryColor}" Margin="0,0,10,0"/>
                    <TextBox x:Name="NameTxt" Width="180" Margin="0,0,20,0"/>
                    <TextBlock Text="Version:" VerticalAlignment="Center" Foreground="{StaticResource TextSecondaryColor}" Margin="0,0,10,0"/>
                    <TextBox x:Name="VersionTxt" Width="60" LostFocus="VersionTxt_LostFocus"/>
                </StackPanel>

                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Button Content="+ Add Message" Style="{StaticResource ModernBtn}" Margin="0,0,10,0" Click="AddMessageBtn_Click"/>
                    <Button Content="+ Add Struct" Style="{StaticResource SecondaryBtn}" Margin="0,0,10,0" Click="AddStructBtn_Click"/>
                    <Button Content="ðŸ“š Versions" Style="{StaticResource SecondaryBtn}" Margin="0,0,10,0" Click="VersionsBtn_Click" ToolTip="View version history"/>
                    <Button Content="ðŸ’¬ Comments" Style="{StaticResource SecondaryBtn}" Margin="0,0,10,0" Click="CommentsBtn_Click" ToolTip="View comments"/>
                    <Button Content="ðŸ“œ History" Style="{StaticResource SecondaryBtn}" Margin="0,0,10,0" Click="HistoryBtn_Click" ToolTip="View change history"/>
                    <Button Content="âœ“ Validate" Style="{StaticResource SecondaryBtn}" Click="ValidateBtn_Click" ToolTip="Validate ICD structure"/>
                </StackPanel>

                <StackPanel Grid.Column="2" Orientation="Horizontal">
                    <Button Content="ðŸ“‹ Copy" Style="{StaticResource SecondaryBtn}" Click="CopyBtn_Click" Margin="0,0,5,0" Width="70" ToolTip="Copy selected item (Ctrl+C)"/>
                    <Button Content="ðŸ“„ Paste" Style="{StaticResource SecondaryBtn}" Click="PasteBtn_Click" Margin="0,0,5,0" Width="70" ToolTip="Paste item (Ctrl+V)"/>
                    <Button Content="â†¶ Undo" Style="{StaticResource SecondaryBtn}" Click="UndoBtn_Click" Margin="0,0,5,0" Width="70" ToolTip="Undo (Ctrl+Z)"/>
                    <Button Content="â†· Redo" Style="{StaticResource SecondaryBtn}" Click="RedoBtn_Click" Margin="0,0,5,0" Width="70" ToolTip="Redo (Ctrl+Y)"/>
                    <Button Content="ðŸ‘ Preview" Style="{StaticResource SecondaryBtn}" Click="PreviewBtn_Click" Margin="0,0,10,0" Width="80" ToolTip="Preview C Header"/>
                    <Button Content="Export to .h" Style="{StaticResource SecondaryBtn}" Click="Export_Click" Margin="0,0,10,0" Width="100"/>
                    <Button Content="Save Changes" Style="{StaticResource ModernBtn}" Click="Save_Click" Width="120"/>
                    <Button Content="Close" Style="{StaticResource SecondaryBtn}" Click="Close_Click" Margin="10,0,0,0" Width="80"/>
                </StackPanel>
            </Grid>
        </Border>

        <Grid Grid.Row="1" Margin="20">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="350"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Border Background="White" CornerRadius="4" BorderBrush="{StaticResource BorderColor}" BorderThickness="1">
                <TreeView x:Name="IcdTree" BorderThickness="0" Padding="10" SelectedItemChanged="IcdTree_SelectedItemChanged">
                    <TreeView.ItemContainerStyle>
                        <Style TargetType="{x:Type TreeViewItem}">
                            <Setter Property="IsExpanded" Value="True"/>
                            <Setter Property="Padding" Value="5"/>
                            <Setter Property="FontSize" Value="14"/>
                            <Setter Property="AllowDrop" Value="True"/>
                            <EventSetter Event="PreviewMouseLeftButtonDown" Handler="Tree_PreviewMouseLeftButtonDown"/>
                            <EventSetter Event="MouseMove" Handler="Tree_MouseMove"/>
                            <EventSetter Event="DragOver" Handler="Tree_DragOver"/>
                            <EventSetter Event="Drop" Handler="Tree_Drop"/>
                        </Style>
                    </TreeView.ItemContainerStyle>
                </TreeView>
            </Border>

            <Border x:Name="EditorPanel" Grid.Column="1" Margin="20,0,0,0" Background="White" CornerRadius="4" BorderBrush="{StaticResource BorderColor}" BorderThickness="1" Visibility="Hidden">
                <StackPanel Margin="20">
                    <TextBlock Text="Properties" FontSize="18" FontWeight="SemiBold" Foreground="{StaticResource PrimaryColor}" Margin="0,0,0,20"/>

                    <TextBlock Text="Name" Foreground="{StaticResource TextSecondaryColor}" Margin="0,0,0,5"/>
                    <TextBox x:Name="PropNameTxt" TextChanged="PropNameTxt_TextChanged" Margin="0,0,0,15"/>

                    <StackPanel x:Name="FieldPropsPanel" Visibility="Collapsed">
                        <TextBlock Text="Data Type" Foreground="{StaticResource TextSecondaryColor}" Margin="0,0,0,5"/>
                        <ComboBox x:Name="PropTypeCombo" Height="35" SelectionChanged="PropTypeCombo_SelectionChanged" Margin="0,0,0,15"/>

                        <TextBlock Text="Size (Bits)" Foreground="{StaticResource TextSecondaryColor}" Margin="0,0,0,5"/>
                        <TextBox x:Name="PropSizeTxt" TextChanged="PropSizeTxt_TextChanged" Margin="0,0,0,5"/>
                        <TextBlock Text="* Set to standard size (e.g. 32 for uint32) to disable bitfield." 
                                   FontSize="10" Foreground="Gray" TextWrapping="Wrap" Margin="0,0,0,15"/>
                    </StackPanel>

                    <StackPanel x:Name="StructLinkPanel" Visibility="Collapsed">
                        <TextBlock Text="Struct Type Definition" Foreground="{StaticResource TextSecondaryColor}" Margin="0,0,0,5"/>
                        <ComboBox x:Name="StructLinkCombo" Height="35" SelectionChanged="StructLinkCombo_SelectionChanged" Margin="0,0,0,15"/>
                        <TextBlock Text="* Defines this item as an instance of the selected struct." 
                                   FontSize="10" Foreground="Gray" TextWrapping="Wrap" Margin="0,0,0,15"/>
                    </StackPanel>

                    <CheckBox x:Name="PropIsUnionChk" Content="Is Union (C union)" Margin="0,5,0,0" Click="PropIsUnionChk_Changed"/>

                    <TextBlock x:Name="DebugInfoTxt" Foreground="Gray" Margin="0,30,0,0" FontStyle="Italic"/>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Window>